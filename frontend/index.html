<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adumuo - Aduan Rakyat Muo | Majlis Perbandaran Muar</title>
    <meta name="description" content="Sistem aduan moden untuk Majlis Perbandaran Muar. Suara Anda, Kemajuan Muo.">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        :root {
            --royal-blue: #002366;
            --gold: #D4AF37;
        }
        
        /* Background Image */
        body {
            background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 35, 102, 0.7) 0%, rgba(212, 175, 55, 0.3) 100%);
            z-index: -1;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 35, 102, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--royal-blue) 0%, #003d99 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 35, 102, 0.3);
        }
        
        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, #f4c430 100%);
            transition: all 0.3s ease;
        }
        
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4);
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
            animation: fadeIn 0.4s ease-in;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-timeline {
            position: relative;
        }
        
        .status-timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--royal-blue), var(--gold));
        }
        
        .status-item {
            position: relative;
            padding-left: 3rem;
        }
        
        .status-item::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 0.5rem;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--royal-blue);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--royal-blue);
        }
        
        .status-item.completed::before {
            background: var(--gold);
            box-shadow: 0 0 0 2px var(--gold);
        }
        
        .status-item.active::before {
            background: var(--gold);
            box-shadow: 0 0 0 2px var(--gold), 0 0 0 4px rgba(212, 175, 55, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            ring: 2px;
            ring-color: var(--royal-blue);
        }
        
        .smooth-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin-top: 1rem;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="min-h-screen">
    
    <!-- Navigation -->
    <nav class="glass-strong sticky top-0 z-50 border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#002366] to-[#003d99] flex items-center justify-center">
                        <span class="text-white font-bold text-lg">A</span>
                    </div>
                    <span class="text-xl font-bold text-[#002366]" data-i18n="app_name">Adumuo</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="#submit" class="text-[#002366] hover:text-[#D4AF37] smooth-transition font-medium" data-i18n="nav_submit">Hantar Aduan</a>
                        <a href="#track" class="text-[#002366] hover:text-[#D4AF37] smooth-transition font-medium" data-i18n="nav_track">Semak Status</a>
                        <a href="#admin" class="text-[#002366] hover:text-[#D4AF37] smooth-transition font-medium" data-i18n="nav_admin">Admin</a>
                    </div>
                    <!-- Language Toggle -->
                    <button onclick="toggleLanguage()" class="px-3 py-1.5 rounded-lg border-2 border-[#002366] text-[#002366] font-semibold text-sm hover:bg-[#002366] hover:text-white smooth-transition">
                        <span id="langDisplay">EN</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative overflow-hidden py-20 md:py-32 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto text-center">
            <div class="inline-block mb-6">
                <span class="px-4 py-2 rounded-full glass-strong text-[#002366] font-semibold text-sm" data-i18n="hero_tagline">Sistem Aduan Moden MPM</span>
            </div>
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold text-white mb-6 leading-tight drop-shadow-lg">
                <span data-i18n="hero_title_1">Suara Anda,</span><br>
                <span class="bg-gradient-to-r from-white to-[#D4AF37] bg-clip-text text-transparent" data-i18n="hero_title_2">Kemajuan Muo</span>
            </h1>
            <p class="text-lg md:text-xl text-white/90 max-w-2xl mx-auto mb-10 leading-relaxed drop-shadow-md" data-i18n="hero_description">
                Platform digital untuk menyampaikan aduan anda kepada Majlis Perbandaran Muar. 
                Kami mendengar, kami bertindak.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#submit" class="btn-primary text-white px-8 py-4 rounded-2xl font-semibold text-lg shadow-lg" data-i18n="hero_btn_submit">Hantar Aduan Baru</a>
                <a href="#track" class="btn-gold text-[#002366] px-8 py-4 rounded-2xl font-semibold text-lg shadow-lg" data-i18n="hero_btn_track">Semak Status Aduan</a>
            </div>
        </div>
    </section>

    <!-- Complaint Form Section -->
    <section id="submit" class="py-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="glass-strong rounded-2xl p-8 md:p-12 shadow-2xl">
                <h2 class="text-3xl md:text-4xl font-bold text-[#002366] mb-2" data-i18n="form_title">Hantar Aduan Baru</h2>
                <p class="text-gray-600 mb-8" data-i18n="form_subtitle">Isi maklumat di bawah untuk menghantar aduan anda</p>
                
                <form id="complaintForm" class="space-y-6" enctype="multipart/form-data">
                    <!-- Step 1: Personal Info -->
                    <div class="form-step active" id="step1">
                        <div class="space-y-6">
                            <div>
                                <label for="citizen_name" class="block text-sm font-semibold text-[#002366] mb-2">
                                    <span data-i18n="form_name">Nama Penuh</span> <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="citizen_name" 
                                    name="citizen_name"
                                    required
                                    class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                                    data-i18n-placeholder="form_name_placeholder"
                                    placeholder="Contoh: Ahmad bin Abdullah"
                                >
                            </div>
                            
                            <div>
                                <label for="category" class="block text-sm font-semibold text-[#002366] mb-2">
                                    <span data-i18n="form_category">Kategori Aduan</span> <span class="text-red-500">*</span>
                                </label>
                                <select 
                                    id="category" 
                                    name="category"
                                    required
                                    class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                                >
                                    <option value="" data-i18n="form_category_select">Pilih Kategori</option>
                                    <option value="Infrastruktur" data-i18n="form_category_infra">Infrastruktur (Jalan, Jambatan, Lampu)</option>
                                    <option value="Kebersihan" data-i18n="form_category_clean">Kebersihan (Sampah, Longkang)</option>
                                    <option value="Keselamatan" data-i18n="form_category_safety">Keselamatan (Lampu Jalan, Tanda Jalan)</option>
                                    <option value="Alam Sekitar" data-i18n="form_category_env">Alam Sekitar (Pokok, Taman)</option>
                                    <option value="Lain-lain" data-i18n="form_category_other">Lain-lain</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button 
                                type="button" 
                                onclick="nextStep(2)"
                                class="btn-primary text-white px-6 py-3 rounded-xl font-semibold"
                                data-i18n="btn_next"
                            >
                                Seterusnya ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Complaint Details -->
                    <div class="form-step" id="step2">
                        <div class="space-y-6">
                            <div>
                                <label for="description" class="block text-sm font-semibold text-[#002366] mb-2">
                                    <span data-i18n="form_description">Penerangan Aduan</span> <span class="text-red-500">*</span>
                                </label>
                                <textarea 
                                    id="description" 
                                    name="description"
                                    required
                                    rows="5"
                                    class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition resize-none"
                                    data-i18n-placeholder="form_description_placeholder"
                                    placeholder="Berikan penerangan terperinci tentang aduan anda..."
                                ></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-[#002366] mb-2" data-i18n="form_image">Gambar Aduan</label>
                                <div class="space-y-3">
                                    <!-- Image Upload Option -->
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-2" data-i18n="form_image_upload">Muat Naik Gambar</label>
                                        <input 
                                            type="file" 
                                            id="image_file" 
                                            name="image_file"
                                            accept="image/*"
                                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                                            onchange="handleImageUpload(event)"
                                        >
                                        <p class="text-xs text-gray-500 mt-1" data-i18n="form_image_upload_hint">Pilih gambar dari peranti anda</p>
                                    </div>
                                    
                                    <!-- OR Divider -->
                                    <div class="flex items-center">
                                        <div class="flex-1 border-t border-gray-300"></div>
                                        <span class="px-3 text-sm text-gray-500" data-i18n="form_image_or">ATAU</span>
                                        <div class="flex-1 border-t border-gray-300"></div>
                                    </div>
                                    
                                    <!-- Image URL Option -->
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-2" data-i18n="form_image_url">Masukkan URL Gambar</label>
                                        <input 
                                            type="url" 
                                            id="image_url" 
                                            name="image_url"
                                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                                            placeholder="https://example.com/image.jpg"
                                            onchange="handleImageUrl(event)"
                                        >
                                        <p class="text-xs text-gray-500 mt-1" data-i18n="form_image_url_hint">Masukkan pautan gambar jika ada</p>
                                    </div>
                                    
                                    <!-- Image Preview -->
                                    <div id="imagePreviewContainer" class="hidden">
                                        <img id="imagePreview" class="image-preview" alt="Preview">
                                        <button type="button" onclick="clearImage()" class="mt-2 text-sm text-red-600 hover:text-red-800" data-i18n="form_image_remove">Buang gambar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button 
                                type="button" 
                                onclick="prevStep(1)"
                                class="px-6 py-3 rounded-xl font-semibold border-2 border-gray-300 text-gray-700 hover:border-[#002366] hover:text-[#002366] smooth-transition"
                                data-i18n="btn_back"
                            >
                                ‚Üê Kembali
                            </button>
                            <button 
                                type="button" 
                                onclick="nextStep(3)"
                                class="btn-primary text-white px-6 py-3 rounded-xl font-semibold"
                                data-i18n="btn_next"
                            >
                                Seterusnya ‚Üí
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Location -->
                    <div class="form-step" id="step3">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-[#002366] mb-2" data-i18n="form_location">Lokasi (Pilihan)</label>
                                <p class="text-xs text-gray-600 mb-4" data-i18n="form_location_hint">Koordinat GPS untuk lokasi aduan</p>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="latitude" class="block text-xs font-medium text-gray-700 mb-1" data-i18n="form_latitude">Latitud</label>
                                        <input 
                                            type="number" 
                                            id="latitude" 
                                            name="latitude"
                                            step="any"
                                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                                            placeholder="2.0442"
                                        >
                                    </div>
                                    <div>
                                        <label for="longitude" class="block text-xs font-medium text-gray-700 mb-1" data-i18n="form_longitude">Longitud</label>
                                        <input 
                                            type="number" 
                                            id="longitude" 
                                            name="longitude"
                                            step="any"
                                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                                            placeholder="102.5689"
                                        >
                                    </div>
                                </div>
                                
                                <button 
                                    type="button"
                                    onclick="getCurrentLocation()"
                                    class="mt-4 text-sm text-[#002366] hover:text-[#D4AF37] font-medium smooth-transition"
                                    data-i18n="form_location_current"
                                >
                                    üìç Gunakan Lokasi Semasa
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button 
                                type="button" 
                                onclick="prevStep(2)"
                                class="px-6 py-3 rounded-xl font-semibold border-2 border-gray-300 text-gray-700 hover:border-[#002366] hover:text-[#002366] smooth-transition"
                                data-i18n="btn_back"
                            >
                                ‚Üê Kembali
                            </button>
                            <button 
                                type="submit"
                                class="btn-gold text-[#002366] px-6 py-3 rounded-xl font-semibold"
                                data-i18n="btn_submit"
                            >
                                Hantar Aduan ‚úì
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Success Message -->
                <div id="successMessage" class="hidden mt-6 p-6 rounded-xl bg-green-50 border border-green-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center">
                            <span class="text-white text-xl">‚úì</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-green-800" data-i18n="success_title">Aduan Berjaya Dihantar!</h3>
                            <p class="text-sm text-green-700"><span data-i18n="success_ref">Nombor Rujukan:</span> <span id="refIdDisplay" class="font-mono font-bold"></span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Error Message -->
                <div id="errorMessage" class="hidden mt-6 p-6 rounded-xl bg-red-50 border border-red-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center">
                            <span class="text-white text-xl">‚úó</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-red-800" data-i18n="error_title">Ralat</h3>
                            <p class="text-sm text-red-700" id="errorText"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Status Tracker Section -->
    <section id="track" class="py-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            <div class="glass-strong rounded-2xl p-8 md:p-12 shadow-2xl">
                <h2 class="text-3xl md:text-4xl font-bold text-[#002366] mb-2" data-i18n="track_title">Semak Status Aduan</h2>
                <p class="text-gray-600 mb-8" data-i18n="track_subtitle">Masukkan nombor rujukan untuk melihat status aduan anda</p>
                
                <div class="mb-8">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input 
                            type="text" 
                            id="refIdSearch"
                            class="flex-1 px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition font-mono"
                            data-i18n-placeholder="track_placeholder"
                            placeholder="MPM-2025-0001"
                        >
                        <button 
                            onclick="checkStatus()"
                            class="btn-primary text-white px-8 py-3 rounded-xl font-semibold whitespace-nowrap"
                            data-i18n="track_btn"
                        >
                            Semak Status
                        </button>
                    </div>
                </div>
                
                <!-- Status Result -->
                <div id="statusResult" class="hidden">
                    <div class="glass rounded-xl p-6 mb-6 bg-white/80">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-[#002366]" id="statusRefId"></h3>
                                <p class="text-sm text-gray-600" id="statusCategory"></p>
                            </div>
                            <span id="statusBadge" class="px-4 py-2 rounded-full font-semibold text-sm"></span>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-sm font-semibold text-gray-700 mb-1" data-i18n="track_name">Nama:</p>
                            <p class="text-gray-800" id="statusName"></p>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-sm font-semibold text-gray-700 mb-1" data-i18n="track_description">Penerangan:</p>
                            <p class="text-gray-800" id="statusDescription"></p>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-sm font-semibold text-gray-700 mb-1" data-i18n="track_date">Tarikh Dihantar:</p>
                            <p class="text-gray-800" id="statusDate"></p>
                        </div>
                    </div>
                    
                    <!-- Timeline -->
                    <div class="status-timeline space-y-6">
                        <div class="status-item completed">
                            <h4 class="font-semibold text-[#002366]" data-i18n="status_submitted">Dihantar</h4>
                            <p class="text-sm text-gray-600" data-i18n="status_submitted_desc">Aduan anda telah diterima</p>
                        </div>
                        <div class="status-item" id="assignedStatus">
                            <h4 class="font-semibold text-gray-400" data-i18n="status_assigned">Ditugaskan</h4>
                            <p class="text-sm text-gray-500" data-i18n="status_assigned_desc">Menunggu untuk ditugaskan</p>
                        </div>
                        <div class="status-item" id="resolvedStatus">
                            <h4 class="font-semibold text-gray-400" data-i18n="status_resolved">Diselesaikan</h4>
                            <p class="text-sm text-gray-500" data-i18n="status_resolved_desc">Menunggu penyelesaian</p>
                        </div>
                    </div>
                </div>
                
                <!-- Not Found Message -->
                <div id="notFoundMessage" class="hidden p-6 rounded-xl bg-yellow-50 border border-yellow-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center">
                            <span class="text-white text-xl">!</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-yellow-800" data-i18n="track_notfound_title">Aduan Tidak Dijumpai</h3>
                            <p class="text-sm text-yellow-700" data-i18n="track_notfound_desc">Sila pastikan nombor rujukan adalah betul</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Login Section -->
    <section id="admin" class="py-20 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md mx-auto">
            <div class="glass-strong rounded-2xl p-8 md:p-12 shadow-2xl">
                <h2 class="text-3xl md:text-4xl font-bold text-[#002366] mb-2 text-center" data-i18n="admin_login_title">Log Masuk Admin</h2>
                <p class="text-gray-600 mb-8 text-center" data-i18n="admin_login_subtitle">Akses dashboard pengurusan aduan</p>
                
                <form id="adminLoginForm" class="space-y-6">
                    <div>
                        <label for="admin_username" class="block text-sm font-semibold text-[#002366] mb-2" data-i18n="admin_username">Nama Pengguna</label>
                        <input 
                            type="text" 
                            id="admin_username" 
                            name="username"
                            required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                            placeholder="admin"
                        >
                    </div>
                    
                    <div>
                        <label for="admin_password" class="block text-sm font-semibold text-[#002366] mb-2" data-i18n="admin_password">Kata Laluan</label>
                        <input 
                            type="password" 
                            id="admin_password" 
                            name="password"
                            required
                            class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white focus:bg-white focus:border-[#002366] smooth-transition"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        >
                    </div>
                    
                    <button 
                        type="submit"
                        class="btn-primary text-white w-full px-6 py-3 rounded-xl font-semibold"
                        data-i18n="admin_login_btn"
                    >
                        Log Masuk
                    </button>
                </form>
                
                <!-- Admin Dashboard (Hidden until login) -->
                <div id="adminDashboard" class="hidden mt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-[#002366]" data-i18n="admin_dashboard_title">Dashboard Admin</h3>
                        <button onclick="adminLogout()" class="text-sm text-red-600 hover:text-red-800" data-i18n="admin_logout">Log Keluar</button>
                    </div>
                    
                    <div id="adminComplaintsList" class="space-y-4">
                        <!-- Complaints will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 px-4 sm:px-6 lg:px-8 border-t border-white/20 mt-20">
        <div class="max-w-7xl mx-auto text-center">
            <div class="flex items-center justify-center space-x-2 mb-4">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-[#002366] to-[#003d99] flex items-center justify-center">
                    <span class="text-white font-bold">A</span>
                </div>
                <span class="text-lg font-bold text-white drop-shadow-md" data-i18n="app_name">Adumuo</span>
            </div>
            <p class="text-white/90 mb-2 drop-shadow-md" data-i18n="footer_tagline">Sistem Aduan Rakyat Muo</p>
            <p class="text-sm text-white/70 drop-shadow-sm">Majlis Perbandaran Muar ¬© 2025</p>
        </div>
    </footer>

    <script>
        // API Configuration - Auto-detect environment
        const API_BASE_URL = (() => {
            // Check if running on localhost
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:8000';
            }
            // Production: Update this with your backend URL
            // Example: return 'https://adumuo-api.railway.app';
            // Example: return 'https://adumuo-api.render.com';
            // For now, return localhost (update when backend is deployed)
            return 'http://localhost:8000';
        })();
        
        console.log('API Base URL:', API_BASE_URL);
        
        // Language Management
        let currentLang = localStorage.getItem('language') || 'ms';
        const translations = {
            ms: {
                app_name: 'Adumuo',
                nav_submit: 'Hantar Aduan',
                nav_track: 'Semak Status',
                nav_admin: 'Admin',
                hero_tagline: 'Sistem Aduan Moden MPM',
                hero_title_1: 'Suara Anda,',
                hero_title_2: 'Kemajuan Muo',
                hero_description: 'Platform digital untuk menyampaikan aduan anda kepada Majlis Perbandaran Muar. Kami mendengar, kami bertindak.',
                hero_btn_submit: 'Hantar Aduan Baru',
                hero_btn_track: 'Semak Status Aduan',
                form_title: 'Hantar Aduan Baru',
                form_subtitle: 'Isi maklumat di bawah untuk menghantar aduan anda',
                form_name: 'Nama Penuh',
                form_name_placeholder: 'Contoh: Ahmad bin Abdullah',
                form_category: 'Kategori Aduan',
                form_category_select: 'Pilih Kategori',
                form_category_infra: 'Infrastruktur (Jalan, Jambatan, Lampu)',
                form_category_clean: 'Kebersihan (Sampah, Longkang)',
                form_category_safety: 'Keselamatan (Lampu Jalan, Tanda Jalan)',
                form_category_env: 'Alam Sekitar (Pokok, Taman)',
                form_category_other: 'Lain-lain',
                form_description: 'Penerangan Aduan',
                form_description_placeholder: 'Berikan penerangan terperinci tentang aduan anda...',
                form_image: 'Gambar Aduan',
                form_image_upload: 'Muat Naik Gambar',
                form_image_upload_hint: 'Pilih gambar dari peranti anda',
                form_image_or: 'ATAU',
                form_image_url: 'Masukkan URL Gambar',
                form_image_url_hint: 'Masukkan pautan gambar jika ada',
                form_image_remove: 'Buang gambar',
                form_location: 'Lokasi (Pilihan)',
                form_location_hint: 'Koordinat GPS untuk lokasi aduan',
                form_latitude: 'Latitud',
                form_longitude: 'Longitud',
                form_location_current: 'üìç Gunakan Lokasi Semasa',
                btn_next: 'Seterusnya ‚Üí',
                btn_back: '‚Üê Kembali',
                btn_submit: 'Hantar Aduan ‚úì',
                success_title: 'Aduan Berjaya Dihantar!',
                success_ref: 'Nombor Rujukan:',
                error_title: 'Ralat',
                track_title: 'Semak Status Aduan',
                track_subtitle: 'Masukkan nombor rujukan untuk melihat status aduan anda',
                track_placeholder: 'MPM-2025-0001',
                track_btn: 'Semak Status',
                track_name: 'Nama:',
                track_description: 'Penerangan:',
                track_date: 'Tarikh Dihantar:',
                track_notfound_title: 'Aduan Tidak Dijumpai',
                track_notfound_desc: 'Sila pastikan nombor rujukan adalah betul',
                status_submitted: 'Dihantar',
                status_submitted_desc: 'Aduan anda telah diterima',
                status_assigned: 'Ditugaskan',
                status_assigned_desc: 'Menunggu untuk ditugaskan',
                status_resolved: 'Diselesaikan',
                status_resolved_desc: 'Menunggu penyelesaian',
                admin_login_title: 'Log Masuk Admin',
                admin_login_subtitle: 'Akses dashboard pengurusan aduan',
                admin_username: 'Nama Pengguna',
                admin_password: 'Kata Laluan',
                admin_login_btn: 'Log Masuk',
                admin_logout: 'Log Keluar',
                admin_dashboard_title: 'Dashboard Admin',
                footer_tagline: 'Sistem Aduan Rakyat Muo'
            },
            en: {
                app_name: 'Adumuo',
                nav_submit: 'Submit Complaint',
                nav_track: 'Check Status',
                nav_admin: 'Admin',
                hero_tagline: 'Modern MPM Complaint System',
                hero_title_1: 'Your Voice,',
                hero_title_2: 'Muo\'s Progress',
                hero_description: 'Digital platform to submit your complaints to Muar Municipal Council. We listen, we act.',
                hero_btn_submit: 'Submit New Complaint',
                hero_btn_track: 'Check Complaint Status',
                form_title: 'Submit New Complaint',
                form_subtitle: 'Fill in the information below to submit your complaint',
                form_name: 'Full Name',
                form_name_placeholder: 'Example: Ahmad bin Abdullah',
                form_category: 'Complaint Category',
                form_category_select: 'Select Category',
                form_category_infra: 'Infrastructure (Roads, Bridges, Lights)',
                form_category_clean: 'Cleanliness (Waste, Drains)',
                form_category_safety: 'Safety (Street Lights, Road Signs)',
                form_category_env: 'Environment (Trees, Parks)',
                form_category_other: 'Others',
                form_description: 'Complaint Description',
                form_description_placeholder: 'Provide a detailed description of your complaint...',
                form_image: 'Complaint Image',
                form_image_upload: 'Upload Image',
                form_image_upload_hint: 'Select image from your device',
                form_image_or: 'OR',
                form_image_url: 'Enter Image URL',
                form_image_url_hint: 'Enter image link if available',
                form_image_remove: 'Remove image',
                form_location: 'Location (Optional)',
                form_location_hint: 'GPS coordinates for complaint location',
                form_latitude: 'Latitude',
                form_longitude: 'Longitude',
                form_location_current: 'üìç Use Current Location',
                btn_next: 'Next ‚Üí',
                btn_back: '‚Üê Back',
                btn_submit: 'Submit Complaint ‚úì',
                success_title: 'Complaint Submitted Successfully!',
                success_ref: 'Reference Number:',
                error_title: 'Error',
                track_title: 'Check Complaint Status',
                track_subtitle: 'Enter reference number to view your complaint status',
                track_placeholder: 'MPM-2025-0001',
                track_btn: 'Check Status',
                track_name: 'Name:',
                track_description: 'Description:',
                track_date: 'Date Submitted:',
                track_notfound_title: 'Complaint Not Found',
                track_notfound_desc: 'Please ensure the reference number is correct',
                status_submitted: 'Submitted',
                status_submitted_desc: 'Your complaint has been received',
                status_assigned: 'Assigned',
                status_assigned_desc: 'Waiting to be assigned',
                status_resolved: 'Resolved',
                status_resolved_desc: 'Waiting for resolution',
                admin_login_title: 'Admin Login',
                admin_login_subtitle: 'Access complaint management dashboard',
                admin_username: 'Username',
                admin_password: 'Password',
                admin_login_btn: 'Login',
                admin_logout: 'Logout',
                admin_dashboard_title: 'Admin Dashboard',
                footer_tagline: 'Muo Public Complaint System'
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'ms' ? 'en' : 'ms';
            localStorage.setItem('language', currentLang);
            updateLanguage();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[currentLang][key]) {
                    el.placeholder = translations[currentLang][key];
                }
            });
            document.getElementById('langDisplay').textContent = currentLang === 'ms' ? 'EN' : 'MS';
        }

        // Initialize language
        updateLanguage();

        // Image Upload Handling
        let selectedImageFile = null;
        let selectedImageUrl = null;

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                selectedImageFile = file;
                selectedImageUrl = null;
                document.getElementById('image_url').value = '';
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreviewContainer').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function handleImageUrl(event) {
            const url = event.target.value;
            if (url) {
                selectedImageUrl = url;
                selectedImageFile = null;
                document.getElementById('image_file').value = '';
                document.getElementById('imagePreview').src = url;
                document.getElementById('imagePreviewContainer').classList.remove('hidden');
            }
        }

        function clearImage() {
            selectedImageFile = null;
            selectedImageUrl = null;
            document.getElementById('image_file').value = '';
            document.getElementById('image_url').value = '';
            document.getElementById('imagePreviewContainer').classList.add('hidden');
        }

        // Form step navigation
        let currentStep = 1;
        const totalSteps = 3;
        
        function showStep(step) {
            document.querySelectorAll('.form-step').forEach(el => {
                el.classList.remove('active');
            });
            document.getElementById(`step${step}`).classList.add('active');
        }
        
        function nextStep(step) {
            if (step <= totalSteps) {
                currentStep = step;
                showStep(step);
            }
        }
        
        function prevStep(step) {
            if (step >= 1) {
                currentStep = step;
                showStep(step);
            }
        }
        
        // Get current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                        document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                    },
                    (error) => {
                        alert(currentLang === 'ms' ? 'Tidak dapat mendapatkan lokasi. Sila masukkan koordinat secara manual.' : 'Unable to get location. Please enter coordinates manually.');
                    }
                );
            } else {
                alert(currentLang === 'ms' ? 'Geolokasi tidak disokong oleh pelayar anda.' : 'Geolocation is not supported by your browser.');
            }
        }
        
        // Submit complaint form
        document.getElementById('complaintForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('citizen_name', document.getElementById('citizen_name').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('description', document.getElementById('description').value);
            
            const latitude = document.getElementById('latitude').value;
            const longitude = document.getElementById('longitude').value;
            if (latitude) formData.append('latitude', latitude);
            if (longitude) formData.append('longitude', longitude);
            
            // Handle image upload
            if (selectedImageFile) {
                formData.append('image_file', selectedImageFile);
            } else if (selectedImageUrl) {
                formData.append('image_url', selectedImageUrl);
            }
            
            // Hide previous messages
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/complaints`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('refIdDisplay').textContent = result.ref_id;
                    document.getElementById('successMessage').classList.remove('hidden');
                    e.target.reset();
                    clearImage();
                    showStep(1);
                    
                    // Scroll to success message
                    document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    const error = await response.json();
                    document.getElementById('errorText').textContent = error.detail || (currentLang === 'ms' ? 'Ralat berlaku semasa menghantar aduan' : 'Error occurred while submitting complaint');
                    document.getElementById('errorMessage').classList.remove('hidden');
                }
            } catch (error) {
                document.getElementById('errorText').textContent = currentLang === 'ms' ? 'Tidak dapat menyambung ke pelayan. Sila cuba lagi kemudian.' : 'Unable to connect to server. Please try again later.';
                document.getElementById('errorMessage').classList.remove('hidden');
            }
        });
        
        // Check status
        async function checkStatus() {
            const refId = document.getElementById('refIdSearch').value.trim();
            
            if (!refId) {
                alert(currentLang === 'ms' ? 'Sila masukkan nombor rujukan' : 'Please enter reference number');
                return;
            }
            
            // Hide previous messages
            document.getElementById('statusResult').classList.add('hidden');
            document.getElementById('notFoundMessage').classList.add('hidden');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/complaints/${refId}`);
                
                if (response.ok) {
                    const complaint = await response.json();
                    
                    // Display complaint info
                    document.getElementById('statusRefId').textContent = complaint.ref_id;
                    document.getElementById('statusCategory').textContent = complaint.category;
                    document.getElementById('statusName').textContent = complaint.citizen_name;
                    document.getElementById('statusDescription').textContent = complaint.description;
                    
                    const date = new Date(complaint.created_at);
                    const locale = currentLang === 'ms' ? 'ms-MY' : 'en-US';
                    document.getElementById('statusDate').textContent = date.toLocaleDateString(locale, {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Status badge
                    const badge = document.getElementById('statusBadge');
                    badge.textContent = complaint.status;
                    if (complaint.status === 'Pending') {
                        badge.className = 'px-4 py-2 rounded-full font-semibold text-sm bg-yellow-100 text-yellow-800';
                    } else if (complaint.status === 'Assigned') {
                        badge.className = 'px-4 py-2 rounded-full font-semibold text-sm bg-blue-100 text-blue-800';
                    } else if (complaint.status === 'Resolved') {
                        badge.className = 'px-4 py-2 rounded-full font-semibold text-sm bg-green-100 text-green-800';
                    }
                    
                    // Update timeline
                    if (complaint.status === 'Assigned' || complaint.status === 'Resolved') {
                        document.getElementById('assignedStatus').classList.add('completed', 'active');
                        document.getElementById('assignedStatus').querySelector('h4').classList.remove('text-gray-400');
                        document.getElementById('assignedStatus').querySelector('h4').classList.add('text-[#002366]');
                        document.getElementById('assignedStatus').querySelector('p').classList.remove('text-gray-500');
                        document.getElementById('assignedStatus').querySelector('p').classList.add('text-gray-600');
                    }
                    
                    if (complaint.status === 'Resolved') {
                        document.getElementById('resolvedStatus').classList.add('completed', 'active');
                        document.getElementById('resolvedStatus').querySelector('h4').classList.remove('text-gray-400');
                        document.getElementById('resolvedStatus').querySelector('h4').classList.add('text-[#002366]');
                        document.getElementById('resolvedStatus').querySelector('p').classList.remove('text-gray-500');
                        document.getElementById('resolvedStatus').querySelector('p').classList.add('text-gray-600');
                    }
                    
                    document.getElementById('statusResult').classList.remove('hidden');
                } else if (response.status === 404) {
                    document.getElementById('notFoundMessage').classList.remove('hidden');
                } else {
                    throw new Error('Server error');
                }
            } catch (error) {
                document.getElementById('errorText').textContent = currentLang === 'ms' ? 'Tidak dapat menyambung ke pelayan. Sila cuba lagi kemudian.' : 'Unable to connect to server. Please try again later.';
                document.getElementById('errorMessage').classList.remove('hidden');
            }
        }
        
        // Allow Enter key to submit status check
        document.getElementById('refIdSearch').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkStatus();
            }
        });

        // Admin Login
        let adminToken = localStorage.getItem('adminToken');
        
        // Wait for DOM to be ready
        function initAdminLogin() {
            const adminLoginForm = document.getElementById('adminLoginForm');
            if (!adminLoginForm) {
                console.error('Admin login form not found!');
                setTimeout(initAdminLogin, 100); // Retry after 100ms
                return;
            }
            
            adminLoginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                console.log('Login form submitted');
                
                const username = document.getElementById('admin_username').value;
                const password = document.getElementById('admin_password').value;
                
                console.log('Attempting login for:', username);
                
                // Show loading state
                const submitBtn = adminLoginForm.querySelector('button[type="submit"]');
                if (!submitBtn) {
                    console.error('Submit button not found!');
                    alert(currentLang === 'ms' ? 'Ralat: Butang tidak dijumpai' : 'Error: Button not found');
                    return;
                }
                
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = currentLang === 'ms' ? 'Memproses...' : 'Processing...';
                
                try {
                // Add timeout to prevent hanging
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                
                const response = await fetch(`${API_BASE_URL}/api/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                let data;
                try {
                    data = await response.json();
                } catch (e) {
                    // If response is not JSON, get text
                    const text = await response.text();
                    console.error('Response text:', text);
                    throw new Error(text || 'Unknown error');
                }
                
                console.log('Login response:', response.status, data);
                
                if (response.ok) {
                    if (data.token) {
                        adminToken = data.token;
                        localStorage.setItem('adminToken', adminToken);
                        document.getElementById('adminLoginForm').classList.add('hidden');
                        document.getElementById('adminDashboard').classList.remove('hidden');
                        loadAdminComplaints();
                    } else {
                        throw new Error('No token received from server');
                    }
                } else {
                    const errorMsg = data.detail || (currentLang === 'ms' ? 'Nama pengguna atau kata laluan tidak betul' : 'Invalid username or password');
                    alert(errorMsg);
                    console.error('Login error:', data);
                }
            } catch (error) {
                console.error('Login error:', error);
                let errorMsg;
                if (error.name === 'AbortError') {
                    errorMsg = currentLang === 'ms' 
                        ? `Masa menunggu tamat. Pastikan backend server berjalan di ${API_BASE_URL}` 
                        : `Request timeout. Make sure backend server is running at ${API_BASE_URL}`;
                } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError') || error.message.includes('ERR_CONNECTION_REFUSED')) {
                    errorMsg = currentLang === 'ms' 
                        ? `Tidak dapat menyambung ke pelayan. Pastikan backend server berjalan di ${API_BASE_URL}.\n\nJalankan: cd backend && python main.py` 
                        : `Unable to connect to server. Make sure backend server is running at ${API_BASE_URL}.\n\nRun: cd backend && python main.py`;
                } else {
                    errorMsg = error.message || (currentLang === 'ms' ? 'Ralat berlaku semasa log masuk' : 'An error occurred during login');
                }
                alert(errorMsg);
            } finally {
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            }
            });
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAdminLogin);
        } else {
            initAdminLogin();
        }

        function adminLogout() {
            adminToken = null;
            localStorage.removeItem('adminToken');
            document.getElementById('adminLoginForm').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('adminComplaintsList').innerHTML = '';
        }

        async function loadAdminComplaints() {
            if (!adminToken) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/complaints`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const complaints = await response.json();
                    displayAdminComplaints(complaints);
                } else if (response.status === 401) {
                    adminLogout();
                }
            } catch (error) {
                console.error('Error loading complaints:', error);
            }
        }

        function displayAdminComplaints(complaints) {
            const container = document.getElementById('adminComplaintsList');
            if (complaints.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center">' + (currentLang === 'ms' ? 'Tiada aduan' : 'No complaints') + '</p>';
                return;
            }
            
            container.innerHTML = complaints.map(complaint => `
                <div class="glass rounded-xl p-6 bg-white/80">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-[#002366]">${complaint.ref_id}</h4>
                            <p class="text-sm text-gray-600">${complaint.category}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${
                            complaint.status === 'Pending' ? 'bg-yellow-100 text-yellow-800' :
                            complaint.status === 'Assigned' ? 'bg-blue-100 text-blue-800' :
                            'bg-green-100 text-green-800'
                        }">${complaint.status}</span>
                    </div>
                    <p class="text-sm text-gray-700 mb-2"><strong>${currentLang === 'ms' ? 'Nama:' : 'Name:'}</strong> ${complaint.citizen_name}</p>
                    <p class="text-sm text-gray-700 mb-4">${complaint.description}</p>
                    <div class="flex gap-2">
                        <select onchange="updateComplaintStatus('${complaint.ref_id}', this.value)" class="flex-1 px-3 py-2 rounded-lg border border-gray-200 text-sm">
                            <option value="Pending" ${complaint.status === 'Pending' ? 'selected' : ''}>Pending</option>
                            <option value="Assigned" ${complaint.status === 'Assigned' ? 'selected' : ''}>Assigned</option>
                            <option value="Resolved" ${complaint.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                        </select>
                    </div>
                </div>
            `).join('');
        }

        async function updateComplaintStatus(refId, status) {
            if (!adminToken) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/complaints/${refId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({ status })
                });
                
                if (response.ok) {
                    loadAdminComplaints();
                }
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }

        // Check if admin is already logged in
        if (adminToken) {
            document.getElementById('adminLoginForm').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadAdminComplaints();
        }
    </script>
</body>
</html>
